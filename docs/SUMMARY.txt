â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ğŸ‰ KAFKA ERROR HANDLING SYSTEM                         â•‘
â•‘                      Production-Ready Implementation                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ Tá»”NG QUAN Há»† THá»NG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Cáº¥u trÃºc Message Má»›i:
   
   {
     "id": "unique-id",                    // UUID - Báº¯t buá»™c
     "timestamp": "2023-10-05T12:34:56Z",  // ISO 8601 - Báº¯t buá»™c
     "level": "ERROR",                      // ERROR/WARNING/INFO - Báº¯t buá»™c
     "service": "tÃªn-service",              // TÃªn service - Báº¯t buá»™c
     "message": "MÃ´ táº£ lá»—i",                // MÃ´ táº£ - Báº¯t buá»™c
     "stackTrace": "stack trace...",        // Stack trace - TÃ¹y chá»n
     "user": "user@example.com",            // User liÃªn quan - TÃ¹y chá»n
     "requestId": "req-abc123",             // Request ID - TÃ¹y chá»n
     "additionalData": {}                   // Dá»¯ liá»‡u bá»• sung - TÃ¹y chá»n
   }

   Chi tiáº¿t Ä‘áº§y Ä‘á»§: MESSAGE_STRUCTURE.md

âœ… TÃ­nh nÄƒng:
   
   1. Dead Letter Queue (DLQ)         â†’ âœ… ÄÃƒ CÃ“
   2. Error Handling                  â†’ âœ… Äáº¦Y Äá»¦
   3. Retry Mechanism                 â†’ âœ… CÃ“ 2 LOáº I


ğŸ“ Cáº¤U TRÃšC FILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

discord-webhook/
â”œâ”€â”€ index.js                  â†’ Consumer chÃ­nh (PRODUCTION-READY)
â”‚   â”œâ”€â”€ âœ… Dead Letter Queue implementation
â”‚   â”œâ”€â”€ âœ… Retry mechanism (2 loáº¡i)
â”‚   â”œâ”€â”€ âœ… Error handling Ä‘áº§y Ä‘á»§
â”‚   â”œâ”€â”€ âœ… Metrics & monitoring
â”‚   â”œâ”€â”€ âœ… Graceful shutdown
â”‚   â””â”€â”€ âœ… Rich Discord embeds

Scripts:
â”œâ”€â”€ create-topics.sh          â†’ Táº¡o táº¥t cáº£ Kafka topics
â”œâ”€â”€ cleanup.sh                â†’ Reset há»‡ thá»‘ng
â”œâ”€â”€ monitor-dlq.sh            â†’ Monitor Dead Letter Queue
â”œâ”€â”€ test-producer.js          â†’ Test vá»›i valid + invalid messages

Documentation:
â”œâ”€â”€ README.md                 â†’ HÆ°á»›ng dáº«n sá»­ dá»¥ng Ä‘áº§y Ä‘á»§
â”œâ”€â”€ ARCHITECTURE.md           â†’ SÆ¡ Ä‘á»“ kiáº¿n trÃºc chi tiáº¿t
â””â”€â”€ FEATURES.md              â†’ Checklist tÃ­nh nÄƒng & test scenarios


ğŸ”§ KAFKA TOPICS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… error-logs              â†’ Main topic (messages má»›i)
âœ… error-logs-retry        â†’ Retry queue (messages Ä‘ang retry)
âœ… error-logs-dlq          â†’ Dead Letter Queue (messages tháº¥t báº¡i)

   Táº¥t cáº£ cÃ³: 3 partitions, replication factor 3


âš™ï¸ TÃNH NÄ‚NG CHI TIáº¾T
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ğŸ“® DEAD LETTER QUEUE (DLQ)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Topic:        error-logs-dlq
   Function:     sendToDLQ() (lines 144-174)
   
   LÆ°u trá»¯:
   âœ“ Original message data
   âœ“ Error stack trace
   âœ“ Metadata (topic, partition, offset)
   âœ“ Attempt count
   âœ“ Timestamps
   
   Monitor:      ./monitor-dlq.sh

2. ğŸ”„ RETRY MECHANISM
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   
   A. Discord Webhook Retry (Immediate)
      Function:      retryWithBackoff() (lines 86-102)
      Max retries:   3
      Backoff:       Exponential (1s â†’ 2s â†’ 4s)
      Use case:      Discord API temporary failures
   
   B. Message Processing Retry (Queue-based)
      Topic:         error-logs-retry
      Function:      sendToRetryQueue() (lines 176-203)
      Max retries:   3
      Delay:         2 seconds per attempt
      Use case:      Parse errors, validation errors

3. ğŸ›¡ï¸ ERROR HANDLING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Function:      processMessage() (lines 205-270)
   
   Handles:
   âœ“ JSON parse errors
   âœ“ Validation errors (missing fields)
   âœ“ Network errors (Discord webhook)
   âœ“ Timeout errors
   âœ“ Unknown errors
   
   Flow:
   Error â†’ Log â†’ Check retry count â†’ Retry OR DLQ â†’ Commit offset

4. ğŸ“Š METRICS & MONITORING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Auto-log:      Every 30 seconds (lines 59-75)
   
   Tracks:
   âœ“ Processed count
   âœ“ Failed count
   âœ“ Retried successfully count
   âœ“ Sent to DLQ count
   âœ“ Discord errors count

5. ğŸ¯ BONUS FEATURES
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   âœ“ Graceful shutdown (SIGTERM/SIGINT handling)
   âœ“ Rich Discord embeds with metadata
   âœ“ Configurable everything (timeouts, retries, delays)
   âœ“ Production Kafka config (timeouts, auto-commit)
   âœ“ Consumer stability (no crashes)


ğŸš€ HÆ¯á»šNG DáºªN Sá»¬ Dá»¤NG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Táº¡o Topics
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   $ ./create-topics.sh
   
   Táº¡o 3 topics: error-logs, error-logs-retry, error-logs-dlq

Step 2: Cháº¡y Consumer
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   $ cd discord-webhook
   $ node index.js
   
   Consumer sáº½:
   - Connect tá»›i Kafka cluster
   - Subscribe tá»›i error-logs vÃ  error-logs-retry
   - Báº¯t Ä‘áº§u xá»­ lÃ½ messages
   - Log metrics má»—i 30s

Step 3: Test
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   $ node test-producer.js
   
   Gá»­i 5 messages:
   - 3 valid   â†’ Sáº½ thÃ nh cÃ´ng â†’ Discord
   - 2 invalid â†’ Retry 3 láº§n â†’ DLQ

Step 4: Monitor DLQ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   $ ./monitor-dlq.sh
   
   Xem messages tháº¥t báº¡i trong DLQ


ğŸ“Š TEST SCENARIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Scenario 1: âœ… Valid Message (Normal Flow)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Producer â†’ error-logs â†’ Parse âœ… â†’ Validate âœ… 
           â†’ Discord âœ… â†’ Commit

Scenario 2: ğŸ”„ Discord Temporary Failure (Immediate Retry)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Producer â†’ error-logs â†’ Parse âœ… â†’ Validate âœ… 
           â†’ Discord âŒ â†’ Retry (1s) 
           â†’ Discord âŒ â†’ Retry (2s) 
           â†’ Discord âœ… â†’ Commit

Scenario 3: âš°ï¸  Invalid Message (DLQ Flow)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Producer â†’ error-logs â†’ Parse âœ… â†’ Validate âŒ 
           â†’ error-logs-retry (attempt 1) â†’ Validate âŒ
           â†’ error-logs-retry (attempt 2) â†’ Validate âŒ
           â†’ error-logs-retry (attempt 3) â†’ Validate âŒ
           â†’ error-logs-dlq âš°ï¸

Scenario 4: ğŸ’¥ Invalid JSON (Parse Error â†’ DLQ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Producer â†’ error-logs â†’ Parse âŒ
           â†’ error-logs-retry (3x attempts) â†’ Parse âŒ
           â†’ error-logs-dlq âš°ï¸


ğŸ” MONITORING & DEBUGGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Check Consumer Metrics:
   â†’ Tá»± Ä‘á»™ng log má»—i 30s trong console

Check Kafka Topics:
   $ docker exec kafka-controller-1 /opt/kafka/bin/kafka-topics.sh \
     --list --bootstrap-server localhost:9092

Check Consumer Group:
   $ docker exec kafka-controller-1 \
     /opt/kafka/bin/kafka-consumer-groups.sh \
     --describe --group discord-group \
     --bootstrap-server localhost:9092

Check DLQ Messages:
   $ ./monitor-dlq.sh

Reset Everything:
   $ ./cleanup.sh


ğŸ“š DOCUMENTATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

README.md         â†’ HÆ°á»›ng dáº«n chi tiáº¿t, configuration, best practices
ARCHITECTURE.md   â†’ SÆ¡ Ä‘á»“ kiáº¿n trÃºc, flow diagrams, deployment
FEATURES.md       â†’ Checklist Ä‘áº§y Ä‘á»§, test scenarios, comparison


ğŸ¯ KEY IMPROVEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TRÆ¯á»šC:                          SAU:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ No DLQ                       âœ… Full DLQ with metadata
âŒ No retry                     âœ… 2 types of retry
âŒ Basic error handling         âœ… Production-grade handling
âŒ No metrics                   âœ… Real-time metrics
âŒ Can crash                    âœ… Stable, graceful shutdown
âŒ Simple logs                  âœ… Rich Discord embeds
âŒ Hard to monitor              âœ… Easy monitoring tools


ğŸ’¡ BEST PRACTICES IMPLEMENTED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Exponential backoff cho retry
âœ“ Separate retry queue Ä‘á»ƒ khÃ´ng block main topic
âœ“ DLQ Ä‘á»ƒ khÃ´ng máº¥t data
âœ“ Metrics cho monitoring
âœ“ Graceful shutdown
âœ“ Configurable timeouts
âœ“ Auto-commit vá»›i interval há»£p lÃ½ (5s)
âœ“ Replication factor 3 cho HA
âœ“ Multiple partitions cho parallelism


ğŸ‰ Káº¾T LUáº¬N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Há»‡ thá»‘ng Kafka cá»§a báº¡n giá» Ä‘Ã¢y ÄÃƒ CÃ“ Äáº¦Y Äá»¦:

âœ… Dead Letter Queue (DLQ)
âœ… Error Handling (comprehensive)
âœ… Retry Mechanism (2 types)
âœ… Monitoring & Metrics
âœ… Production-ready configuration

Táº¥t cáº£ Ä‘á»u Ä‘Æ°á»£c implement theo best practices vÃ  sáºµn sÃ ng cho 
production environment! ğŸš€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            Made with â¤ï¸ by AI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
